// Int√©gration du SDK Telegram (√† mettre dans l'en-t√™te de ton projet)
// <script src="https://telegram.org/js/telegram-web-app.js"></script>

import React, { useState, useEffect } from 'react';

const GarbaTycoon = () => {
  // 1. √âtat du score avec sauvegarde locale
  const [points, setPoints] = useState(() => {
    const saved = localStorage.getItem('garbaPoints');
    return saved ? parseInt(saved) : 0;
  });

  const [clicks, setClicks] = useState([]);

  // Sauvegarde automatique d√®s que le score change
  useEffect(() => {
    localStorage.setItem('garbaPoints', points);
  }, [points]);

  const handleTap = (e) => {
    // 2. VIBRATION (Haptic Feedback Telegram)
    if (window.Telegram?.WebApp?.HapticFeedback) {
      window.Telegram.WebApp.HapticFeedback.impactOccurred('medium');
    } else if (navigator.vibrate) {
      navigator.vibrate(50); // Secours pour navigateur classique
    }

    // 3. Mise √† jour du score
    setPoints(prev => prev + 1);

    // 4. Animation visuelle (+1)
    const rect = e.currentTarget.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    const newClick = { id: Date.now(), x, y };
    
    setClicks([...clicks, newClick]);
    setTimeout(() => {
      setClicks(prev => prev.filter(c => c.id !== newClick.id));
    }, 800);
  };

  return (
    <div style={styles.container}>
      <h1 style={styles.title}>GARBATYCOON</h1>
      <div style={styles.scoreBoard}>
        <span style={{ fontSize: '40px' }}>üí∞</span>
        <span style={styles.points}>{points.toLocaleString()}</span>
      </div>

      <div style={styles.clickArea} onClick={handleTap}>
        {/* Lien direct vers l'image du plat de Garba */}
        <img 
          src="https://i.ibb.co/m5mX9nC/garba-plate.png" 
          alt="Garba" 
          style={styles.gabbaImage}
        />
        {clicks.map(c => (
          <span key={c.id} style={{ ...styles.plusOne, top: c.y, left: c.x }}>+1</span>
        ))}
      </div>

      <div style={styles.footer}>
        <div style={styles.btn}>üçü Menu</div>
        <div style={styles.btn}>üìà Boosts</div>
        <div style={styles.btn}>ü§ù Amis</div>
      </div>
    </div>
  );
};

// Styles CSS int√©gr√©s pour √©viter les fichiers manquants
const styles = {
  container: { height: '100vh', background: 'radial-gradient(circle, #3d2616, #000)', color: 'white', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'space-between', userSelect: 'none', touchAction: 'manipulation' },
  title: { color: '#ffaa00', fontSize: '2.5rem', marginTop: '20px' },
  scoreBoard: { display: 'flex', alignItems: 'center', gap: '10px' },
  points: { fontSize: '3rem', fontWeight: 'bold' },
  clickArea: { position: 'relative', width: '300px', height: '300px' },
  gabbaImage: { width: '100%', filter: 'drop-shadow(0 0 20px rgba(255,170,0,0.5))', cursor: 'pointer' },
  plusOne: { position: 'absolute', color: '#00ff00', fontSize: '2rem', fontWeight: 'bold', pointerEvents: 'none', animation: 'floatUp 0.8s forwards' },
  footer: { width: '100%', display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '10px', padding: '20px' },
  btn: { background: '#ffaa00', color: 'black', padding: '15px', borderRadius: '15px', textAlign: 'center', fontWeight: 'bold' }
};

export default GarbaTycoon;
