<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Garba King - Le Jeu Officiel</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { text-align: center; font-family: 'Segoe UI', sans-serif; background-color: #0b0b0b; color: white; margin: 0; padding-bottom: 80px; }
        .header { background: #1a1a1a; padding: 15px; border-bottom: 2px solid #f39c12; font-weight: bold; color: #f39c12; }
        
        /* Stats globales (L'Accord) */
        #global-stats { font-size: 0.8em; background: #222; padding: 10px; color: #bbb; }

        .main-container { padding: 20px; }
        .score-box { margin: 20px auto; }
        .score { font-size: 3.5em; font-weight: bold; color: #fff; text-shadow: 0 0 10px rgba(243,156,18,0.5); }
        
        #garba-img { width: 220px; cursor: pointer; transition: transform 0.1s; filter: drop-shadow(0 0 20px rgba(243,156,18,0.3)); }
        #garba-img:active { transform: scale(0.92); }

        /* Menu de navigation (Arcade) */
        .nav-bar { position: fixed; bottom: 0; width: 100%; display: flex; background: #1a1a1a; border-top: 1px solid #333; height: 70px; }
        .nav-item { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; font-size: 0.8em; }
        .nav-item.active { color: #f39c12; border-top: 2px solid #f39c12; }

        .leaderboard { background: #161616; border-radius: 15px; padding: 15px; margin-top: 20px; text-align: left; }
        .player-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #222; }
        
        #arcade-page { display: none; padding: 20px; }
        .btn-claim { background: #f39c12; border: none; padding: 10px 20px; border-radius: 8px; color: black; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div id="game-page">
        <div class="header">üç≤ GARBA KING üç≤</div>
        <div id="global-stats">Chargement des donn√©es mondiales...</div>

        <div class="main-container">
            <div id="user-welcome" style="font-size: 0.9em; margin-bottom: 10px;">Salut, Chef !</div>
            <div class="score-box">
                <div class="score" id="count">0</div>
                <div style="color: #f39c12; letter-spacing: 2px;">GARBAS</div>
            </div>
            
            <img id="garba-img" src="https://cdn-icons-png.flaticon.com/512/1546/1546611.png" alt="Garba">
            
            <div class="leaderboard">
                <h4 style="margin: 0 0 10px 0; color: #f39c12;">üèÜ TOP WINNERS</h4>
                <div id="leaderboard-list"></div>
            </div>
        </div>
    </div>

    <div id="arcade-page">
        <div class="header">üéÆ ARCADE CENTER</div>
        <div style="margin-top: 20px;">
            <div style="background: #222; padding: 15px; border-radius: 12px; margin-bottom: 15px;">
                <p>Rejoins notre canal Telegram</p>
                <button class="btn-claim" onclick="addBonus(1000)">+ 1,000 üç≤</button>
            </div>
            <div style="background: #222; padding: 15px; border-radius: 12px;">
                <p>Bonus Quotidien</p>
                <button class="btn-claim" onclick="addBonus(500)">R√©cup√©rer</button>
            </div>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="nav('game')">üç≤ Jeu</div>
        <div class="nav-item" onclick="nav('arcade')">üéÆ Arcade</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, query, orderByChild, limitToLast } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // Configuration Firebase (Garbaking-5f435)
        const firebaseConfig = {
            apiKey: "AIzaSyAvXVAZhasqI_GqGpFyyClvr2JeakfqlVU",
            authDomain: "garbaking-5f435.firebaseapp.com",
            projectId: "garbaking-5f435",
            storageBucket: "garbaking-5f435.appspot.com",
            databaseURL: "https://garbaking-5f435-default-rtdb.firebaseio.com/"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Connexion Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();
        const user = tg.initDataUnsafe?.user;
        const userId = user ? user.id : "local_test_id";
        const userName = user ? (user.username || user.first_name) : "Chef Anonyme";

        document.getElementById('user-welcome').innerText = "Chef : " + userName;

        const myScoreRef = ref(db, 'users/' + userId);
        let currentScore = 0;

        // √âcoute du score perso
        onValue(myScoreRef, (snapshot) => {
            const val = snapshot.val();
            if(val) {
                currentScore = val.score;
                document.getElementById('count').innerText = currentScore.toLocaleString();
            }
        });

        // Clic sur le Garba
        document.getElementById('garba-img').onclick = () => {
            currentScore++;
            saveScore();
        };

        // Fonction de sauvegarde
        function saveScore() {
            set(myScoreRef, {
                nom: userName,
                score: currentScore,
                updatedAt: Date.now()
            });
        }

        // Ajout bonus (Arcade)
        window.addBonus = (amt) => {
            currentScore += amt;
            saveScore();
            alert("Bonus de " + amt + " ajout√© !");
        };

        // Navigation entre Jeu et Arcade
        window.nav = (page) => {
            document.getElementById('game-page').style.display = page === 'game' ? 'block' : 'none';
            document.getElementById('arcade-page').style.display = page === 'arcade' ? 'block' : 'none';
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active');
        };

        // Statistiques Globales et Leaderboard
        const usersRef = ref(db, 'users');
        onValue(usersRef, (snapshot) => {
            let totalGarbas = 0;
            let totalPlayers = 0;
            let players = [];

            snapshot.forEach(child => {
                const data = child.val();
                totalGarbas += data.score;
                totalPlayers++;
                players.push(data);
            });

            document.getElementById('global-stats').innerText = `üåç COMMUNAUT√â : ${totalPlayers} JOUEURS | üç≤ TOTAL : ${totalGarbas.toLocaleString()}`;

            // Top 5 Winners
            players.sort((a,b) => b.score - a.score);
            const list = document.getElementById('leaderboard-list');
            list.innerHTML = "";
            players.slice(0, 5).forEach((p, i) => {
                list.innerHTML += `<div class="player-row"><span>#${i+1} ${p.nom}</span><b>${p.score.toLocaleString()}</b></div>`;
            });
        });
    </script>
</body>
                    </html>
                    
