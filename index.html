<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GarbaTycoon Evolution</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            margin: 0; padding: 0;
            background: #050a0f; color: white; font-family: 'Arial', sans-serif;
            display: flex; flex-direction: column; align-items: center;
            height: 100vh; overflow: hidden;
        }

        .header { text-align: center; margin-top: 15px; }
        .score-container { font-size: 50px; font-weight: bold; color: #f39c12; margin: 0; }
        .passive-income { color: #1fb0a3; font-size: 14px; }

        .click-area { flex-grow: 1; display: flex; justify-content: center; align-items: center; width: 100%; }
        .main-circle {
            width: 220px; height: 220px; border-radius: 50%;
            border: 6px solid #333; display: flex; justify-content: center; align-items: center;
            background: radial-gradient(circle, #1a3a5a 0%, #050a0f 100%);
            box-shadow: 0 0 30px rgba(243, 156, 18, 0.3);
            transition: transform 0.05s;
        }
        .main-circle:active { transform: scale(0.95); }
        .garba-img { width: 180px; border-radius: 50%; }

        /* SECTION CARTES */
        .cards-section {
            width: 100%; background: #0d1b2a; border-radius: 25px 25px 0 0;
            padding: 15px; box-sizing: border-box;
        }
        .cards-container {
            display: flex; gap: 12px; overflow-x: auto; padding-bottom: 10px;
        }

        /* STYLE DES CARTES SELON LE NIVEAU */
        .card {
            min-width: 150px; background: #1a3a5a; border-radius: 15px;
            padding: 12px; text-align: center; border: 2px solid #333;
            transition: 0.3s; position: relative;
        }
        
        /* Raret√© Or */
        .card.gold { border-color: #f1c40f; box-shadow: 0 0 10px #f1c40f; }
        /* Raret√© Platine/Elev√© */
        .card.platinum { border-color: #3498db; box-shadow: 0 0 10px #3498db; }
        /* Raret√© Diamant */
        .card.diamond { border-color: #9b59b6; box-shadow: 0 0 20px #9b59b6; background: linear-gradient(145deg, #1a3a5a, #4b0082); }

        .card-lvl { font-size: 10px; color: #aaa; margin-bottom: 5px; }
        .card-title { font-size: 13px; font-weight: bold; display: block; height: 32px; }
        .card-bonus { color: #2ecc71; font-size: 11px; margin: 5px 0; }
        .card-price-btn {
            background: #f39c12; color: black; border-radius: 8px;
            padding: 8px; font-weight: bold; margin-top: 5px; cursor: pointer;
        }
        .card.maxed .card-price-btn { background: #555; cursor: default; }

        .plus-one { position: absolute; color: white; font-size: 30px; font-weight: bold; animation: floatUp 0.7s forwards; }
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-100px); opacity: 0; } }
    </style>
</head>
<body>

    <div class="header">
        <div class="score-container" id="score">0</div>
        <div class="passive-income">Revenu : +<span id="passive-val">0</span>/h</div>
    </div>

    <div class="click-area">
        <div class="main-circle" id="tap-target">
            <img src="https://i.ibb.co/30a0574/garba-img.jpg" class="garba-img" onerror="this.src='https://raw.githubusercontent.com/richard-coding-officiel/Garba_tycoon/main/garba-img.jpg'">
        </div>
    </div>

    <div class="cards-section">
        <div style="font-size: 12px; margin-bottom: 10px; color: #888;">Am√©liorer vos produits (Max Nv. 15)</div>
        <div class="cards-container" id="cards-list">
            </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        let score = 0;
        let totalPassive = 0;

        const upgradeData = [
            { id: 0, name: "Thon de Qualit√©", basePrice: 200, baseProfit: 15, lvl: 0 },
            { id: 1, name: "Huile Parfum√©e", basePrice: 800, baseProfit: 45, lvl: 0 },
            { id: 2, name: "Piment de Grand-M√®re", basePrice: 2500, baseProfit: 120, lvl: 0 },
            { id: 3, name: "Atti√©k√© de Dabou", basePrice: 7000, baseProfit: 350, lvl: 0 },
            { id: 4, name: "Stand de Luxe", basePrice: 15000, baseProfit: 800, lvl: 0 }
        ];

        function renderCards() {
            const container = document.getElementById('cards-list');
            container.innerHTML = "";
            upgradeData.forEach(item => {
                let currentPrice = Math.floor(item.basePrice * Math.pow(1.5, item.lvl));
                let currentProfit = item.baseProfit * (item.lvl + 1);
                
                let rarityClass = "";
                if (item.lvl >= 15) rarityClass = "diamond maxed";
                else if (item.lvl >= 10) rarityClass = "platinum";
                else if (item.lvl >= 5) rarityClass = "gold";

                container.innerHTML += `
                    <div class="card ${rarityClass}">
                        <div class="card-lvl">Niveau ${item.lvl}/15</div>
                        <span class="card-title">${item.name}</span>
                        <div class="card-bonus">+${currentProfit}/h</div>
                        <div class="card-price-btn" onclick="buyCard(${item.id})">
                            ${item.lvl >= 15 ? 'MAX' : 'ü™ô ' + currentPrice.toLocaleString()}
                        </div>
                    </div>
                `;
            });
        }

        function buyCard(id) {
            let item = upgradeData[id];
            let price = Math.floor(item.basePrice * Math.pow(1.5, item.lvl));
            
            if (item.lvl < 15 && score >= price) {
                score -= price;
                item.lvl++;
                calculatePassive();
                renderCards();
                updateUI();
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
            } else if (item.lvl < 15) {
                tg.showAlert("Points insuffisants !");
            }
        }

        function calculatePassive() {
            totalPassive = upgradeData.reduce((acc, item) => acc + (item.lvl * item.baseProfit), 0);
        }

        function updateUI() {
            document.getElementById('score').innerText = Math.floor(score).toLocaleString();
            document.getElementById('passive-val').innerText = totalPassive.toLocaleString();
        }

        document.getElementById('tap-target').addEventListener('touchstart', (e) => {
            score += 1;
            updateUI();
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
            
            const touch = e.touches[0];
            const plus = document.createElement('div');
            plus.className = 'plus-one';
            plus.style.left = touch.clientX + 'px';
            plus.style.top = touch.clientY + 'px';
            plus.innerText = "+1";
            document.body.appendChild(plus);
            setTimeout(() => plus.remove(), 700);
        });

        // Gain passif par seconde
        setInterval(() => {
            if (totalPassive > 0) {
                score += (totalPassive / 3600);
                updateUI();
            }
        }, 1000);

        renderCards();
        updateUI();
    </script>
</body>
</html>
